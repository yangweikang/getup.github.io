<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="md.css">
    <title>Webpack针对第三方js库的持久化缓存解决方案</title>
</head>

<body>
    <h2 id="wow1" class="wow_head">Webpack针对第三方js库的持久化缓存解决方案:</h2>
    <h4 id="wow1_1" class="wow_head">背景：</h4>
    <pre><code class="language-bash">    架构：Vue+Webpcak+Jquery+Echars单页应用
            前提：项目开发中应用过多的第三方插件库，如Echars,Jquery，这种第三方库，至于为什么项目中引入这些库有些事历史原因有些则是需求原因；
            导致：由于页面采用单页形式导致一个，js过大；
            解决：分离出第三方库；</code></pre>
    <h4 id="wow1_2" class="wow_head">webpack分离第三方库,部分配置<a href="mailto:webpack@3.6.0">webpack@3.6.0</a>如下：</h4>
    <pre><code class="language-js"><span class="hljs-keyword">module</span>.<span class="hljs-keyword">exports</span> = {
            entry: {
                <span class="hljs-string">'vendor'</span>: [<span class="hljs-string">'jquery'</span>]
            },   
            plugins: [
                <span class="hljs-keyword">new</span> webpack.optimize.CommonsChunkPlugin({
                    names: [<span class="hljs-string">'vendor'</span>, <span class="hljs-string">'manifest'</span>],
                    minChunks: Infinity
                })
            ]
        }</code></pre>
    <h4 id="wow1_3" class="wow_head">触发问题</h4>
    <pre><code>1. <span class="hljs-selector-tag">Webpack</span>每次打包出的第三方库（<span class="hljs-selector-tag">vendor</span>.<span class="hljs-selector-attr">[hash]</span><span class="hljs-selector-class">.js</span>）<span class="hljs-selector-tag">js</span>总是在变化不利于缓存！</code></pre>
    <h5 id="wow1_3_1" class="wow_head">解决：</h5>
    <blockquote>
        <p>为什么我没有改动库的源码hash值为什么会改变呢？</p>
    </blockquote>
    <ul>
        <li>
            <p>这样就浮出webpack三种hash值输出：</p>
            <p> 1.1 hash：该hash计算方式是计算所有chunks的 hash-&gt;适用于dev环境;</p>
            <p> 1.2 chunkhash：为每个chunk计算hash-&gt;适用于prod环境；</p>
            <p> 1.3 contenthash：根据文件内容计算hash-&gt;适用于css文件；</p>
        </li>
    </ul>
    <blockquote>
        <p>总结：综上选择1.2解决hash变动问题；</p>
    </blockquote>
    <ul>
        <li>配置：
            <pre><code class="language-js">   <span class="hljs-selector-tag">output</span>: {
              <span class="hljs-attribute">filename</span>: <span class="hljs-string">'[name].[chunkhash:8].bundle.js'</span>,
              chunkFilename: <span class="hljs-string">'[name].[chunkhash:8].bundle.js'</span>,
          }</code></pre>
            注意：(chunkhash)不能和热编译模块(HotModuleReplacementPlugin)一起使用该hash；</li>
    </ul>
    <h4 id="wow1_4" class="wow_head">触发问题</h4>
    <pre><code>2. 采用<span class="hljs-selector-tag">manifest</span>解决了，异动的<span class="hljs-selector-tag">js</span>变化但是，多了<span class="hljs-selector-tag">manifest</span><span class="hljs-selector-class">.js</span>增加<span class="hljs-selector-tag">web</span>请求！</code></pre>
    <h5 id="wow1_4_1" class="wow_head">解决</h5>
    <pre><code>因为这个代码<span class="hljs-selector-tag">manifest</span>量并不是很大所以，内联进<span class="hljs-selector-tag">index</span><span class="hljs-selector-class">.html</span>，需要两个插件：
        1. <span class="hljs-selector-tag">html-webpack-plugin</span>@<span class="hljs-keyword">2</span>.<span class="hljs-keyword">30</span>.<span class="hljs-keyword">1</span>
        <span class="hljs-number">2</span>. inline-manifest-webpack-plugin@<span class="hljs-number">3.0</span>.<span class="hljs-number">1</span>
        <span class="hljs-number">3</span>. HashedModuleIdsPlugin</code></pre>
    <ul>
        <li>配置：</li>
        <li>webpack.config.prod
            <pre><code class="language-js">  <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">InlineManifestWebpackPlugin</span>({
             <span class="hljs-attribute">name</span>: <span class="hljs-string">'webpackManifest'</span>
         }),
         <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">HtmlWebpackPlugin</span>({
             <span class="hljs-attribute">template</span>: <span class="hljs-string">'index.html'</span>, 
             inject: true
         })
          <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">webpack</span><span class="hljs-selector-class">.HashedModuleIdsPlugin</span>()</code></pre>
        </li>
        <li>
            <p>index.html</p>
            <pre><code class="language-html">   <span class="hljs-section">&lt;%=htmlWebpackPlugin.files.webpackManifest%&gt;</span></code></pre>
            <p> 注意：HtmlWebpackPlugin与html-loder无法并行；</p>
            <blockquote>
                <p>扩展前端部署：<a href="https://www.zhihu.com/question/20790576/answer/32602154">https://www.zhihu.com/question/20790576/answer/32602154</a></p>
            </blockquote>
        </li>
    </ul>
    <div class="BlogAnchor" style="display: none;"><span style="color:red;position:absolute;top:-3px;left:3px;cursor:pointer;"
            onclick="document.getElementsByClassName('BlogAnchor')[0].style.display = 'none';">X</span>
        <p><b id="AnchorContentToggle" title="Expand" style="cursor:pointer;">Content▲</b></p>
        <div class="AnchorContent" id="AnchorContent" style="max-height: 497px;">
            <li><a class="nav_item item_h1 anchor-link" onclick="return false;" href="#" link="#wow1">1 Long term cache
                    ：Webpack针对第三方js库的持久化缓存解决方案:</a></li>
            <li><a class="nav_item item_h2 anchor-link" onclick="return false;" href="#" link="#wow1_1">1.1 背景：</a></li>
            <li><a class="nav_item item_h2 anchor-link" onclick="return false;" href="#" link="#wow1_2">1.2 webpack分离第三方库,部分配置webpack@3.6.0如下：</a></li>
            <li><a class="nav_item item_h2 anchor-link" onclick="return false;" href="#" link="#wow1_3">1.3 触发问题</a></li>
            <li><a class="nav_item item_h3 anchor-link" onclick="return false;" href="#" link="#wow1_3_1">1.3.1 解决：</a></li>
            <li><a class="nav_item item_h2 anchor-link" onclick="return false;" href="#" link="#wow1_4">1.4 触发问题</a></li>
            <li><a class="nav_item item_h3 anchor-link current" onclick="return false;" href="#" link="#wow1_4_1">1.4.1 解决</a></li>
        </div>
    </div>
</body>

</html>